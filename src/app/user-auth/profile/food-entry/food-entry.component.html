<div class="daily-food-log" [ngClass]="{ shrink: showCalculationResult }">
  <app-date-switcher
    [selectedDate]="currentDate"
    (dateChange)="onDateChange($event)"
  ></app-date-switcher>
  <div>
    <app-results-section
      [breakfastItems]="breakfastItems"
      [lunchItems]="lunchItems"
      [dinnerItems]="dinnerItems"
      [snackItems]="snackItems"
    ></app-results-section>
  </div>

  <div class="meals-container">
    <section class="meal-section">
      <h2 class="meal-title">Breakfast</h2>

      <div class="food-list" *ngIf="breakfastItems.length > 0">
        <div
          *ngFor="let food of breakfastItems; let i = index"
          class="food-item"
        >
          <div class="food-details">
            <span class="food-name">{{ food.foodName }}</span>
            <div class="food-info">
              <span class="serving-info"
                >{{ food.numberOfServings }} {{ food.servingSize }}
                {{ food.numberOfServings <= 1 ? "serving" : "servings" }}</span
              >
              <span class="oxalate-info"
                >Total Oxalate: {{ food.oxalatePerServing }}</span
              >
              <span class="soluble-info"
                >Soluble Oxalate: {{ food.solubleOxalatePerServing }}</span
              >
            </div>
          </div>
          <button
            class="delete-btn"
            (click)="deleteFood('breakfast', i)"
            [attr.aria-label]="'Delete ' + food.foodName"
          >
            <i class="material-icons">close</i>
          </button>
        </div>
      </div>

      <div class="empty-state" *ngIf="breakfastItems.length === 0">
        <span>No foods added yet</span>
      </div>
      <button class="button" (click)="openCalculator('breakfast')">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 20 20"
          fill="none"
          class="svg-icon"
        >
          <g stroke-width="1.5" stroke-linecap="round" stroke="#2b6cb0">
            <path d="M10 2v16M2 10h16" />
          </g>
        </svg>
        <span class="lable">Add Food</span>
      </button>
    </section>

    <section class="meal-section">
      <h2 class="meal-title">Lunch</h2>

      <div class="food-list" *ngIf="lunchItems.length > 0">
        <div *ngFor="let food of lunchItems; let i = index" class="food-item">
          <div class="food-details">
            <span class="food-name">{{ food.foodName }}</span>
            <div class="food-info">
              <span class="serving-info"
                >{{ food.numberOfServings }} {{ food.servingSize }}
                {{ food.numberOfServings <= 1 ? "serving" : "servings" }}</span
              >
              <span class="oxalate-info"
                >Total Oxalate: {{ food.oxalatePerServing }}</span
              >
              <span class="soluble-info"
                >Soluble Oxalate: {{ food.solubleOxalatePerServing }}</span
              >
            </div>
          </div>
          <button
            class="delete-btn"
            (click)="deleteFood('lunch', i)"
            [attr.aria-label]="'Delete ' + food.foodName"
          >
            <i class="material-icons">close</i>
          </button>
        </div>
      </div>

      <div class="empty-state" *ngIf="lunchItems.length === 0">
        <span>No foods added yet</span>
      </div>

      <button class="button" (click)="openCalculator('lunch')">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 20 20"
          fill="none"
          class="svg-icon"
        >
          <g stroke-width="1.5" stroke-linecap="round" stroke="#2b6cb0">
            <path d="M10 2v16M2 10h16" />
          </g>
        </svg>
        <span class="lable">Add Food</span>
      </button>
    </section>

    <section class="meal-section">
      <h2 class="meal-title">Dinner</h2>

      <div class="food-list" *ngIf="dinnerItems.length > 0">
        <div *ngFor="let food of dinnerItems; let i = index" class="food-item">
          <div class="food-details">
            <span class="food-name">{{ food.foodName }}</span>
            <div class="food-info">
              <span class="serving-info"
                >{{ food.numberOfServings }} {{ food.servingSize }}
                {{ food.numberOfServings <= 1 ? "serving" : "servings" }}</span
              >
              <span class="oxalate-info"
                >Total Oxalate: {{ food.oxalatePerServing }}</span
              >
              <span class="soluble-info"
                >Soluble Oxalate: {{ food.solubleOxalatePerServing }}</span
              >
            </div>
          </div>
          <button
            class="delete-btn"
            (click)="deleteFood('dinner', i)"
            [attr.aria-label]="'Delete ' + food.foodName"
          >
            <i class="material-icons">close</i>
          </button>
        </div>
      </div>

      <div class="empty-state" *ngIf="dinnerItems.length === 0">
        <span>No foods added yet</span>
      </div>

      <button class="button" (click)="openCalculator('dinner')">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 20 20"
          fill="none"
          class="svg-icon"
        >
          <g stroke-width="1.5" stroke-linecap="round" stroke="#2b6cb0">
            <path d="M10 2v16M2 10h16" />
          </g>
        </svg>
        <span class="lable">Add Food</span>
      </button>
    </section>

    <section class="meal-section">
      <h2 class="meal-title">Snacks</h2>

      <div class="food-list" *ngIf="snackItems.length > 0">
        <div *ngFor="let food of snackItems; let i = index" class="food-item">
          <div class="food-details">
            <span class="food-name">{{ food.foodName }}</span>
            <div class="food-info">
              <span class="serving-info"
                >{{ food.numberOfServings }} {{ food.servingSize }}
                {{ food.numberOfServings <= 1 ? "serving" : "servings" }}</span
              >
              <span class="oxalate-info"
                >Total Oxalate: {{ food.oxalatePerServing }}</span
              >
              <span class="soluble-info"
                >Soluble Oxalate: {{ food.solubleOxalatePerServing }}</span
              >
            </div>
          </div>
          <button
            class="delete-btn"
            (click)="deleteFood('snacks', i)"
            [attr.aria-label]="'Delete ' + food.foodName"
          >
            <i class="material-icons">close</i>
          </button>
        </div>
      </div>

      <div class="empty-state" *ngIf="snackItems.length === 0">
        <span>No foods added yet</span>
      </div>
      <button class="button" (click)="openCalculator('snacks')">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 20 20"
          fill="none"
          class="svg-icon"
        >
          <g stroke-width="1.5" stroke-linecap="round" stroke="#2b6cb0">
            <path d="M10 2v16M2 10h16" />
          </g>
        </svg>
        <span class="lable">Add Food</span>
      </button>
    </section>
  </div>
</div>

<div class="calculator-dialog" *ngIf="showCalculator" [@dialogAnimation]>
  <div class="dialog-overlay" (click)="closeCalculator()"></div>
  <div class="dialog-content">
    <app-calculate-oxalate
      [mealType]="selectedMealType"
      (mealLogged)="onMealLogged($event)"
    ></app-calculate-oxalate>
  </div>
</div>
